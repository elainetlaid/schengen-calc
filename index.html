<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Schengen Calculator</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ç”³æ ¹è¨ˆç®—">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/elainetlaid/schengen-calc/main/icon.png?v=1">
    <link rel="icon" href="https://raw.githubusercontent.com/elainetlaid/schengen-calc/main/icon.png?v=1">
    
    <style>
        :root { 
            --primary: #1a2a6c; --stay-color: #b3c7ff; --accent: #ff4757; --warning: #ffa500; --success: #28a745;
            --bg: #fdfdfd; --text: #333; --card: #f0f4ff; --border: #ddd; --modal: #fff; --footer-text: #1a2a6c;
            --header-bg: rgba(255, 255, 255, 0.8);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a1a; --text: #eee; --card: #2c2c2e; --border: #444; --modal: #2c2c2e;
                --stay-color: #3a5ba0; --footer-text: #ffffff;
                --header-bg: rgba(26, 26, 26, 0.9);
            }
            body { background: #000; color: #eee; }
            h3 { color: #fff !important; }
            input, select { background: #3a3a3c !important; color: white !important; border-color: #444 !important; }
            .day { background: #1a1a1a !important; border-color: #333 !important; }
            .day span { color: #eee !important; }
            .nav-btn, .today-btn, .step-btn { background: #333 !important; border: 1px solid #444 !important; color: white !important; }
            .action-btn { background: var(--card) !important; color: var(--text) !important; border-color: var(--border) !important; }
            .back-btn { background: #3a3a3c !important; color: white !important; }
        }
        
        /* å…¨åŸŸä½ˆå±€ï¼šé–å®šè¦–çª—é«˜åº¦ */
        html, body { height: 100%; margin: 0; overflow: hidden; }
        body { background: #222; display: flex; justify-content: center; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: var(--text); }
        
        .app { 
            width: 100%; max-width: 430px; 
            height: 100dvh; background: var(--bg); 
            box-sizing: border-box; display: flex; flex-direction: column; 
        }
        
        /* 1. ç˜¦èº«å¾Œçš„æ¨™é¡Œåˆ— */
        .top-bar {
            padding-top: env(safe-area-inset-top);
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 100; flex-shrink: 0;
        }
        .top-bar-content { height: 36px; display: flex; align-items: center; justify-content: center; padding: 0 15px; }
        .app-title { font-size: 15px; font-weight: 700; color: var(--primary); letter-spacing: -0.3px; }

        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 10px; flex-shrink: 0; }
        .month-selector-btn { border: none; background: transparent; font-weight: bold; font-size: 16px; color: var(--text); cursor: pointer; padding: 5px 10px; border-radius: 8px; }
        .month-display { display: flex; align-items: center; gap: 4px; }
        .today-btn { background: #eee; border: 1px solid #ccc; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }
        .nav-btn { background: var(--primary); color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* 2. é‡é»ï¼šæ—¥æ›†å€æ”¹ç‚ºè‡ªå‹•å¢é•·ä¸”å¯æ»¾å‹• */
        #calBox { 
            flex: 1; 
            overflow-y: auto; 
            padding: 0 10px 10px;
            -webkit-overflow-scrolling: touch; /* iOS é †æ»‘æ»¾å‹• */
        }
        
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); background: var(--primary); color: white; font-weight: bold; text-align: center; padding: 4px 0; font-size: 12px; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0; border-left: 1px solid var(--border); border-top: 1px solid var(--border); margin-bottom: 10px; }
        .day { background: white; height: 42px; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); position: relative; box-sizing: border-box; }
        .day span { position: absolute; top: 1px; left: 3px; font-size: 14px; font-weight: 600; color: #333; }
        .remain { position: absolute; right: 1.5px; bottom: 1px; font-size: 10px; color: #888; font-weight: bold; }
        .rem-warn { color: var(--warning) !important; font-size: 11px; }
        .rem-danger { color: var(--accent) !important; font-size: 11px; }
        .note-tag { position: absolute; left: 2px; bottom: 1px; font-size: 9px; color: #5dade2; font-weight: bold; max-width: 65%; overflow: hidden; white-space: nowrap; }
        .stay { background: var(--stay-color) !important; }
        .stay-start { border-radius: 8px 0 0 8px; }
        .stay-end { border-radius: 0 8px 8px 0; }

        /* 3. åº•éƒ¨å€åŸŸï¼šå¼·åˆ¶å›ºå®šåœ¨åº• */
        .bottom-section { flex-shrink: 0; background: var(--bg); }
        .btn-container { padding: 5px 10px 10px; display: flex; gap: 8px; }
        .action-btn { background: white; color: var(--primary); border: 1.5px solid var(--primary); padding: 10px; border-radius: 12px; font-size: 14px; font-weight: bold; cursor: pointer; flex: 1; }
        .btn-main { flex: 2; }

        .footer-summary { 
            padding: 12px 5px calc(12px + env(safe-area-inset-bottom)); 
            background: var(--card); border-top: 1px solid var(--border); border-radius: 20px 20px 0 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
        }
        .footer-line { margin: 4px 0; font-size: 13px; font-weight: bold; color: var(--footer-text); display: flex; justify-content: center; align-items: center; gap: 4px; }
        .footer-line span { color: var(--accent); font-size: 14.5px; }
        .calc-input-group { display: flex; align-items: center; gap: 5px; }
        .calc-input { width: 45px; background: rgba(128, 128, 128, 0.1); border: 1px solid var(--border); border-radius: 5px; color: var(--accent); font-weight: 900; font-size: 16px; text-align: center; padding: 2px 0; outline: none; }
        .step-btn { background: #eee; border: 1px solid #ccc; border-radius: 4px; width: 24px; height: 24px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* Modal æ¨£å¼çœç•¥ï¼Œä¿æŒåŸæœ¬è¨­è¨ˆ */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 999; padding: 20px; }
        .modal-content { background: var(--modal); width: 100%; max-width: 340px; padding: 18px; border-radius: 20px; box-sizing: border-box; color: var(--text); position: relative; }
        .form-row { display: flex; align-items: center; margin-bottom: 15px; gap: 8px; }
        .form-row label { width: 55px; font-weight: 800; font-size: 17px; }
        .form-row input, .form-row select { flex: 1; padding: 12px; border: 1.5px solid var(--border); border-radius: 12px; font-size: 16px; }
        .main-btn { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: bold; width: 100%; }
        .back-btn { background: #f0f0f0; color: #333; border: none; padding: 12px; border-radius: 12px; cursor: pointer; width: 100%; margin-top: 8px; font-size: 17px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
        .record-card { background: var(--card); padding: 12px; margin-bottom: 8px; border-radius: 12px; border: 1px solid var(--border); }
        .backup-group { display: flex; gap: 8px; margin-top: 15px; }
        .sec-btn { background: transparent; border: 1px solid var(--border); color: #888; padding: 8px; border-radius: 8px; font-size: 12px; flex: 1; }
    </style>
</head>
<body>
<div class="app">
    <div class="top-bar">
        <div class="top-bar-content">
            <span class="app-title">Schengen Calculator</span>
        </div>
    </div>

    <div class="header">
        <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
        <div class="month-display">
            <button id="mLabel" class="month-selector-btn" onclick="showJump()">----å¹´ --æœˆ</button>
            <div class="today-btn" onclick="goToday()">ğŸ«</div>
        </div>
        <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
    </div>

    <div id="calBox"></div>
    
    <div class="bottom-section">
        <div class="btn-container">
            <button class="action-btn btn-main" onclick="showList()">ğŸ“‹ å‡ºå…¥å¢ƒç´€éŒ„ç®¡ç†</button>
            <button class="action-btn" onclick="showHelp()">â“ä½¿ç”¨èªªæ˜</button>
        </div>

        <div class="footer-summary" id="footerSummary">
            <div class="footer-line" id="line1">è¼‰å…¥ä¸­...</div>
            <div class="footer-line">
                è‹¥éœ€å…¥å¢ƒ 
                <div class="calc-input-group">
                    <button class="step-btn" onclick="stepDays(-1)">-</button>
                    <input type="tel" id="targetDays" class="calc-input" value="" oninput="updateTargetDays(this.value)" placeholder="0">
                    <button class="step-btn" onclick="stepDays(1)">+</button>
                </div>
                å¤©ï¼Œæœ€å¿«å¯è‡ª <span id="earliestDate">----/--/--</span> èµ·å…¥å¢ƒ
            </div>
        </div>
    </div>
</div>

<script>
    /* ä¿ç•™æ‰€æœ‰åŸå§‹ Script é‚è¼¯ */
    // ... (åŒ…å« cur, data, hide, render, getRem, findEarliestEntry ç­‰æ‰€æœ‰å‡½æ•¸)
</script>
</body>
</html>
